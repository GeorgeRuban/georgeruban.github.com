<head>
  <title>Shortest Path, JavaScript; George Ruban</title>
  <style>
#board {
  line-height: 12px;
}
  </style>
  <script src="TinyQueue.js"></script>
  <script>

    /** The board to trace the path over. */
    var height = 30;
    var width = 60;
    /** Contains integers; distance from start, or negative values for special. */
    var cells;
    var initialCol = 4;
    var initialRow = 4;

    var IMPASSIBLE = -1;

    var INFINITY_SYMBOL = '\u221e';
    var FULL_STAR_SYMBOL = '\u2605';
    var EMPTY_STAR_SYMBOL = '\u2729';
    var FULL_BLOCK_SYMBOL = '\u2588';

    /** Creates/clears the HTML table and matching cells array. */
    function createBoard() {
      var board = document.querySelector('#board');
      var table = document.createElement('table');
      cells = [];
      for (var row = 0; row < height; ++row) {
        var tr = document.createElement('tr');
        var cellRow = [];
        for (var col = 0; col < width; ++col) {
          var td = document.createElement('td');
          td.textContent = INFINITY_SYMBOL;
          td.id = row + ':' + col;
          td.onclick = onClickCell(td, row, col);
          tr.appendChild(td);
          cellRow.push(Number.MAX_VALUE);
        }
        cells.push(cellRow);
        table.appendChild(tr);
      }
      board.appendChild(table);
      
      // Set start and end cells.
      setValue(initialRow, initialCol, 0, EMPTY_STAR_SYMBOL);
      setValue(height - 5, width - 5, Number.MAX_VALUE, FULL_STAR_SYMBOL);
    }

    /** Return onClick handler that toggles a cell from empty to block. */
    function onClickCell(td, row, col) {  
      return function() {
        if (cells[row][col] < 0) {
          cells[row][col] = Number.MAX_VALUE;
          td.textContent = INFINITY_SYMBOL;
        } else {
          cells[row][col] = IMPASSIBLE;
          td.textContent = FULL_BLOCK_SYMBOL;
        }
      }
    }
    
    /** Return an array of {row, col, val} objects for cells neighboring the input. */
    function getNeighbors(row, col) {
      var array = [];
      for (var i = row -1; i < row + 2; ++i) {
        for (var j = col -1; j < col + 2; ++j) {
          if (i >= 0 && i < height && j >= 0 && j < width &&
              (i != row || j != col) && cells[i][j] > 0) {
            array.push(cellObject(row, col));
          }
        }
      }
      return array;
    }
    
    function cellObject(row, col) {
      return {row: row, col: col, val: cells[row][col]};
    }
    
    function dijkstra() {
      // Priority queue.
      var unvisited = new TinyQueue([], function(a, b) {
        return a.val - b.val});
      for (var row = 0; row < height; ++row) {
        for (var col = 0; col < width; ++col) {
          if (cells[row][col] >= 0) {
            unvisited.push(cellObject(row, col));
          }
        }
      }
      while(unvisited.length > 0) {
        var current = unvisited.pop();
        var neighbors = getNeighbors(current.row, current.col);
        for (var i = 0; i < neighbors.length; ++i) {
          if (neighbors[i].val > current.val + 1) {
            setValue(neighbors[i].row, neighbors[i].col, val);
          }
        }
      }
    }
    
    /** Set the value of input cell. */
    function setValue(row, col, val, symbol) {
      cells[row][col] = val;
      var td = document.getElementById(initialRow + ':' + initialCol);
      if (symbol) {
        td.onclick = null;
      } else {
        symbol = '' + val;
      }
      td.textContent = symbol;
    }
  </script>
</head>
<body onload="createBoard();">
  <h1>Shortest Path algorithm in JavaScript</h1>
  <h2>George Ruban</h2>

  <div id="board"></div>
  <button onclick="dijkstra();">Run Dijkstra's algorithm</button>
  <button onclick="createBoard();">Reset board</button>
  

</body>
