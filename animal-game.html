<head>
  <script src="http://cdn.jsdelivr.net/alasql/0.3/alasql.min.js"></script>
  <script type="text/sql" id="sql">
CREATE TABLE Questions (
    Id INT PRIMARY KEY,
    Txt TEXT,
    Yes INT FOREIGN KEY REFERENCES(Id),
    No INT FOREIGN KEY REFERENCES(Id)
);

INSERT INTO Questions (Id, Txt, Yes, No) VALUES (0, "Does it fly", 1, 2);
INSERT INTO Questions (Id, Txt) VALUES (1, "Pelican");
INSERT INTO Questions (Id, Txt) VALUES (2, "Water buffalo");

  </script>
<script type="text/javascript">
/** Node in the animal game binary tree. */
function Question(text) {
  this.text = text;
  this.yes = null;
  this.no = null;
  this.parent = null;
  
  this.isLeaf = function() {
    return !this.yes && !this.no;
  };
  
  this.addChild = function(child, yesAnswer) {
    child.parent = this;
    if (yesAnswer) {
      this.yes = child;
    } else {
      this.no = child;
    }
  };
}

var questions = alasql('SELECT * FROM Questions ORDER BY Id DESC;');
var map = {};
for (var i = 0; i < questions.length; ++i) {
  map[questions[i].Id] = questions[i];
}

var root = new Question("Does it fly");
root.addChild(new Question("Water Buffalo"), false);
root.addChild(new Question("Pelican"), true);

function say(text) {
  alert(text);
}
  
function ask(text) {
  return confirm(text + "?");
}
  
function askInput(text) {
  return prompt(text + "?");
}
  
function playGame() {
  var q = root;
  
  while (true) {
    if (q.isLeaf()) {
      var a = ask("Is it a " + q.text);
      if (a) {
        say("Hurrah!");
      } else {
        var animal = askInput("Whoops. What animal were you thinking of");
        var newQuestion = askInput("What would be a yes/no question that would differentiate between a " +
                                   animal + " and a " + q.text);
        a = ask("What would be the answer to '" + newQuestion + "' for a " + animal);
        animal = new Question(animal);
        newQuestion = new Question(newQuestion);
        qa = (q.parent.yes == q);
        q.parent.addChild(newQuestion, qa);
        newQuestion.addChild(animal, a);
        newQuestion.addChild(q, !a);
      }
      break;
    } else {
      var a = ask(q.text);
      q = a ? q.yes : q.no;
    }
  }
}
</script>
</head>
<body>
<h1>Animal game</h1>
  This is a learning game; the computer learns from you.
  To play:
  <ol>
    <li>Think of a type of animal.
    <li>Press the "Play" button.
    <li>The game will ask you a yes/no question about the animal. Answer it (yes/OK; no/Cancel).
    <li>Eventually the game will guess what the animal is. If it guesses wrong, it will ask you to 
    teach it another question to ask in the next game.
    <li>The more games you play, the more questions, and animals, the game will learn.
  </ol>
  <button onClick="playGame()">Play the Animal guessing game</button>
</body>
