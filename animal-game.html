<head>
  <script src="https://cdn.jsdelivr.net/alasql/0.3/alasql.min.js"></script>
  <script type="text/sql" id="sql">
CREATE TABLE Nodes (
    id INT PRIMARY KEY,
    txt TEXT,
    yesChild INT FOREIGN KEY REFERENCES Nodes(Id),
    noChild INT FOREIGN KEY REFERENCES Nodes(Id)
);

INSERT INTO Nodes (id, txt) VALUES (1, "Pelican");
INSERT INTO Nodes (id, txt) VALUES (2, "Water buffalo");
INSERT INTO Nodes (id, txt, yesChild, noChild) VALUES (0, "Does it fly", 1, 2);

  </script>
<script type="text/javascript">
/** Node in the animal game binary tree. */
function Node(text) {
  this.text = text;
  this.yes = null;
  this.no = null;
  this.parent = null;
  
  this.isLeaf = function() {
    return !this.yes && !this.no;
  };
  
  this.addChild = function(child, yesAnswer) {
    child.parent = this;
    if (yesAnswer) {
      this.yes = child;
    } else {
      this.no = child;
    }
  };
}

var root;

function loadFromDatabase() {
  // Root - nothing points to it.
  var sql = alasql('SELECT * FROM Nodes WHERE id NOT IN ' +
                 '(SELECT yesChild FROM Nodes UNION SELECT noChild FROM Nodes)')[0];
  root = new Node(sql.txt);
  root.sql = sql;
  var queue = [root];

  while(queue.length > 0) {
    var node = queue.shift();
    for (var child in {'yesChild':'', 'noChild':''}) {
      if (node.sql[child]) {
        sql = alasql('SELECT * FROM Nodes WHERE id = ?;', node.sql[child])[0];
        var newNode = new Node(sql.txt);
        newNode.sql = sql;
        node.addChild(newNode, child == 'yesChild');
        queue.push(newNode);
      }
    }
  }
}

alasql('SOURCE "#sql"');
loadFromDatabase();
  
  
function say(text) {
  alert(text);
}
  
function ask(text) {
  return confirm(text + "?");
}
  
function askInput(text) {
  return prompt(text + "?");
}
  
function playGame() {
  var node = root;
  
  while (true) {
    if (node.isLeaf()) {
      var answer = ask("Is it a " + node.text);
      if (answer) {
        say("Hurrah!");
      } else {
        var animal = askInput("Whoops. What animal were you thinking of");
        var question = askInput("What would be a yes/no question that would differentiate between a " +
                                   animal + " and a " + node.text);
        answer = ask("What would be the answer to '" + question + "' for a " + animal);
        var animalNode = new Node(animal);
        var questionNode = new Node(question);
        var isYesChild = (node.parent.yes == node);
        node.parent.addChild(questionNode, isYesChild);
        questionNode.addChild(animal, answer);
        questionNode.addChild(node, !answer);
      }
      break;
    } else {
      var answer = ask(node.text);
      node = answer ? node.yes : node.no;
    }
  }
}
</script>
</head>
<body>
<h1>Animal game</h1>
  This is a learning game; the computer learns from you.
  To play:
  <ol>
    <li>Think of a type of animal.
    <li>Press the "Play" button.
    <li>The game will ask you a yes/no question about the animal. Answer it (yes/OK; no/Cancel).
    <li>Eventually the game will guess what the animal is. If it guesses wrong, it will ask you to 
    teach it another question to ask in the next game.
    <li>The more games you play, the more questions, and animals, the game will learn.
  </ol>
  <button onClick="playGame()">Play the Animal guessing game</button>
</body>
